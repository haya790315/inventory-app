<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('ダッシュボード')}"></head>
<body>
    <nav th:replace="~{fragments/layout :: navbar(dashboard)}"></nav>
    
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav th:replace="~{fragments/layout :: sidebar(dashboard)}"></nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 min-h-80">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">
                        <i class="bi bi-speedometer2 me-2"></i>ダッシュボード
                    </h1>
                </div>

                <!-- Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card dashboard-card">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                                            アイテム数
                                        </div>
                                        <div class="stat-number" th:text="${totalItems ?: '0'}">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-box fs-2 text-white-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card dashboard-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                                            カテゴリ数
                                        </div>
                                        <div class="stat-number" th:text="${totalCategories ?: '0'}">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-tags fs-2 text-white-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card stat-card dashboard-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-uppercase mb-1">
                                            低在庫アラート
                                        </div>
                                        <div class="stat-number" th:text="${lowStockItems ?: '0'}">0</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="bi bi-exclamation-triangle fs-2 text-white-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities and Low Stock Alerts -->
                <div class="row">
                    <!-- Recent Activities -->
                    <div class="col-lg-8 mb-4">
                        <div class="card dashboard-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-clock-history me-2"></i>最近の活動
                                </h5>
                                <a th:href="@{/records}" class="btn btn-sm btn-outline-primary">
                                    すべて表示
                                </a>
                            </div>
                            <div class="card-body">
                                <div th:if="${recentActivities != null and !recentActivities.empty}">
                                    <div class="list-group list-group-flush">
                                        <div th:each="activity : ${recentActivities}" class="list-group-item list-group-item-action border-0">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">
                                                    <span th:switch="${activity.type != null ? activity.type.name() : ''}">
                                                        <i th:case="'IN'" class="bi bi-plus-circle text-success me-1"></i>
                                                        <i th:case="'OUT'" class="bi bi-dash-circle text-danger me-1"></i>
                                                    </span>
                                                    <span th:text="${activity.itemName}">アイテム名</span>
                                                    <span th:text="${activity.categoryName}" class="badge bg-primary bg-gradient ms-2">カテゴリー名</span>
                                                    <span>
                                                      <span th:if="${activity.type != null and activity.type.name() == 'IN'}" class="badge bg-success ms-2">入庫</span>
                                                      <span th:if="${activity.type != null and activity.type.name() == 'OUT'}"      class="badge bg-danger ms-2">出庫</span>
                                                    </span>
                                                </h6>
                                                <small class="text-muted" th:text="${activity.timestamp}">5分前</small>
                                            </div>
                                            <p class="mb-1">
                                                数量: <span th:text="${activity.quantity}">10</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div th:if="${recentActivities == null or recentActivities.empty}" class="text-center text-muted py-4">
                                    <i class="bi bi-inbox fs-1"></i>
                                    <p class="mt-2">最近の活動はありません</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Low Stock Alerts -->
                    <div class="col-lg-4 mb-4">
                        <div class="card dashboard-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">
                                    <i class="bi bi-exclamation-triangle me-2 text-warning"></i>在庫アラート
                                </h5>
                                <span class="badge bg-warning" th:text="${lowStockAlerts != null ? lowStockAlerts.size() : 0}">0</span>
                            </div>
                            <div class="card-body">
                                <div th:if="${lowStockAlerts != null and !lowStockAlerts.empty}">
                                    <div class="list-group list-group-flush">
                                        <div th:each="item : ${lowStockAlerts}" class="list-group-item border-0 px-0">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-0" th:text="${item.itemName}">アイテム名</h6>
                                                    <small class="text-muted" th:text="${item.categoryName}">カテゴリ</small>
                                                </div>
                                                <span class="badge bg-danger" th:text="${item.warning}">アラート</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div th:if="${lowStockAlerts == null or lowStockAlerts.empty}" class="text-center text-muted py-4">
                                    <i class="bi bi-check-circle fs-1 text-success"></i>
                                    <p class="mt-2">在庫は充分です</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div th:replace="~{fragments/layout :: quick-actions}"></div>
            </main>
        </div>
    </div>

    <footer th:replace="~{fragments/layout :: footer}"></footer>
    <th:block th:replace="~{fragments/layout :: scripts}"></th:block>
</body>
</html>
